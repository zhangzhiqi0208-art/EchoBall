<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘å¤„ç†ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { border-left: 4px solid #52c41a; }
        .info { border-left: 4px solid #1890ff; }
        .warning { border-left: 4px solid #faad14; }
        .error { border-left: 4px solid #ff4d4f; }
        
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        
        .debug-info {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .file-upload-area {
            border: 2px dashed #ccc;
            padding: 40px;
            text-align: center;
            border-radius: 8px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-area:hover {
            border-color: #1890ff;
            background: #f0f8ff;
        }
        
        .file-upload-area.dragover {
            border-color: #52c41a;
            background: #f6ffed;
        }
        
        .uploaded-file {
            background: #f0f8ff;
            border: 1px solid #1890ff;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ éŸ³é¢‘å¤„ç†ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section success">
        <h3>âœ… ä¿®å¤å†…å®¹</h3>
        <ul>
            <li><strong>å¤šæ–¹å¼æ–‡ä»¶è·å–</strong>ï¼šä»inputå…ƒç´ ã€å…¨å±€å˜é‡ã€å·²ä¸Šä¼ æ–‡ä»¶åŒºåŸŸè·å–éŸ³é¢‘æ–‡ä»¶</li>
            <li><strong>å…¨å±€æ–‡ä»¶å­˜å‚¨</strong>ï¼šåœ¨`handleAudioFileUpload`ä¸­å°†æ–‡ä»¶å­˜å‚¨åˆ°`window.selectedAudioFile`</li>
            <li><strong>è¯¦ç»†è°ƒè¯•æ—¥å¿—</strong>ï¼šæ·»åŠ äº†å®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥</li>
            <li><strong>å…¼å®¹æ€§å¤„ç†</strong>ï¼šç¡®ä¿æ‹–æ‹½å’Œç‚¹å‡»ä¸Šä¼ éƒ½èƒ½æ­£ç¡®å·¥ä½œ</li>
        </ul>
    </div>
    
    <div class="test-section info">
        <h3>ğŸ§ª æµ‹è¯•æ­¥éª¤</h3>
        <ol>
            <li>ä¸Šä¼ ä¸€ä¸ªéŸ³é¢‘æ–‡ä»¶ï¼ˆç‚¹å‡»æˆ–æ‹–æ‹½ï¼‰</li>
            <li>ç‚¹å‡»"ä¸€é”®è½¬åŒ–"æŒ‰é’®</li>
            <li>æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
                <ul>
                    <li><code>ğŸµ å¤„ç†éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ : [æ–‡ä»¶å]</code></li>
                    <li><code>âœ… éŸ³é¢‘æ–‡ä»¶å·²å­˜å‚¨åˆ°å…¨å±€å˜é‡: [æ–‡ä»¶å]</code></li>
                    <li><code>ğŸµ å¼€å§‹å¤„ç†éŸ³é¢‘åŸå£°</code></li>
                    <li><code>ğŸŒ ä»å…¨å±€å˜é‡è·å–éŸ³é¢‘æ–‡ä»¶: [æ–‡ä»¶å]</code></li>
                </ul>
            </li>
            <li>éªŒè¯ä¸å†å‡ºç°"è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶"é”™è¯¯</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h3>ğŸµ æ¨¡æ‹ŸéŸ³é¢‘ä¸Šä¼ æµ‹è¯•</h3>
        <p>ç‚¹å‡»ä¸‹é¢çš„åŒºåŸŸä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼š</p>
        
        <div class="file-upload-area" id="audioUploadArea">
            <div style="font-size: 48px; color: #1890ff; margin-bottom: 16px;">ğŸ¤</div>
            <p style="font-size: 16px; margin: 0 0 8px 0;">ç‚¹å‡»æˆ–æ‹–æ‹½éŸ³é¢‘æ–‡ä»¶åˆ°æ­¤åŒºåŸŸä¸Šä¼ </p>
            <p style="font-size: 14px; color: #666; margin: 0;">æ”¯æŒ MP3ã€WAVã€M4Aã€OGG æ ¼å¼ï¼Œæœ€å¤§ 25MB</p>
        </div>
        
        <input type="file" id="audioFileInput" accept="audio/*" style="display: none;">
        
        <div id="audioUploadedFiles"></div>
        
        <div style="margin: 20px 0;">
            <button class="test-button" onclick="testAudioProcessing()">ğŸ¯ æµ‹è¯•éŸ³é¢‘å¤„ç†</button>
            <button class="test-button" onclick="clearAudioFile()">ğŸ—‘ï¸ æ¸…é™¤æ–‡ä»¶</button>
        </div>
        
        <div class="debug-info" id="debugInfo">
            ç­‰å¾…ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶...
        </div>
    </div>
    
    <div class="test-section warning">
        <h3>âš ï¸ å¦‚æœä»ç„¶æœ‰é—®é¢˜</h3>
        <p>è¯·æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
        <ul>
            <li>ç¡®ä¿éŸ³é¢‘æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼ˆMP3ã€WAVã€M4Aã€OGGï¼‰</li>
            <li>æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡25MB</li>
            <li>æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯</li>
            <li>ç¡®è®¤åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ</li>
        </ul>
    </div>
    
    <script>
        // æ¨¡æ‹ŸOriginalSoundTemplateçš„åŠŸèƒ½
        const AudioTestTemplate = {
            // å¤„ç†éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ 
            handleAudioFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                console.log('ğŸµ å¤„ç†éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ :', file.name, file.size, file.type);
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!file.type.startsWith('audio/')) {
                    alert('è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                    return;
                }
                
                // éªŒè¯æ–‡ä»¶å¤§å° (25MB)
                if (file.size > 25 * 1024 * 1024) {
                    alert('éŸ³é¢‘æ–‡ä»¶è¶…è¿‡25MBé™åˆ¶');
                    return;
                }
                
                // å­˜å‚¨æ–‡ä»¶åˆ°å…¨å±€å˜é‡
                window.selectedAudioFile = file;
                console.log('âœ… éŸ³é¢‘æ–‡ä»¶å·²å­˜å‚¨åˆ°å…¨å±€å˜é‡:', file.name);
                
                this.displayUploadedFile(file, 'audioUploadedFiles');
                
                // æ¸…ç©ºinputï¼Œå…è®¸é‡å¤é€‰æ‹©åŒä¸€æ–‡ä»¶
                event.target.value = '';
            },
            
            // æ˜¾ç¤ºå·²ä¸Šä¼ çš„æ–‡ä»¶
            displayUploadedFile(file, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = `
                    <div class="uploaded-file">
                        <strong>ğŸ“ ${file.name}</strong>
                        <br>
                        <small>å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB</small>
                        <br>
                        <small>ç±»å‹: ${file.type}</small>
                    </div>
                `;
                
                // æ›´æ–°è°ƒè¯•ä¿¡æ¯
                document.getElementById('debugInfo').innerHTML = `
                    <strong>âœ… æ–‡ä»¶å·²ä¸Šä¼ </strong><br>
                    æ–‡ä»¶å: ${file.name}<br>
                    å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    ç±»å‹: ${file.type}<br>
                    å…¨å±€å˜é‡: ${window.selectedAudioFile ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®'}
                `;
            },
            
            // å¤„ç†éŸ³é¢‘åŸå£°ï¼ˆæ¨¡æ‹Ÿï¼‰
            async processAudioOriginalSound() {
                console.log('ğŸµ å¼€å§‹å¤„ç†éŸ³é¢‘åŸå£°');
                
                // å°è¯•å¤šç§æ–¹å¼è·å–éŸ³é¢‘æ–‡ä»¶
                let audioFile = null;
                
                // æ–¹å¼1ï¼šä»inputå…ƒç´ è·å–
                const audioFileInput = document.getElementById('audioFileInput');
                if (audioFileInput && audioFileInput.files && audioFileInput.files[0]) {
                    audioFile = audioFileInput.files[0];
                    console.log('âœ… ä»inputå…ƒç´ è·å–éŸ³é¢‘æ–‡ä»¶:', audioFile.name);
                }
                
                // æ–¹å¼2ï¼šä»å·²ä¸Šä¼ çš„æ–‡ä»¶æ˜¾ç¤ºåŒºåŸŸè·å–
                if (!audioFile) {
                    const uploadedFilesContainer = document.getElementById('audioUploadedFiles');
                    if (uploadedFilesContainer && uploadedFilesContainer.dataset.file) {
                        const fileInfo = JSON.parse(uploadedFilesContainer.dataset.file);
                        console.log('ğŸ“ ä»å·²ä¸Šä¼ æ–‡ä»¶åŒºåŸŸè·å–æ–‡ä»¶ä¿¡æ¯:', fileInfo);
                    }
                }
                
                // æ–¹å¼3ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å…¨å±€å­˜å‚¨çš„éŸ³é¢‘æ–‡ä»¶
                if (!audioFile && window.selectedAudioFile) {
                    audioFile = window.selectedAudioFile;
                    console.log('ğŸŒ ä»å…¨å±€å˜é‡è·å–éŸ³é¢‘æ–‡ä»¶:', audioFile.name);
                }
                
                console.log('ğŸ” éŸ³é¢‘æ–‡ä»¶æ£€æŸ¥ç»“æœ:', {
                    audioFile: !!audioFile,
                    fileName: audioFile ? audioFile.name : 'æ— '
                });
                
                if (!audioFile) {
                    throw new Error('è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                }
                
                // æ¨¡æ‹Ÿå¤„ç†æˆåŠŸ
                return {
                    success: true,
                    message: 'éŸ³é¢‘å¤„ç†æˆåŠŸ',
                    fileName: audioFile.name
                };
            }
        };
        
        // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
        function initializeEventListeners() {
            const audioUploadArea = document.getElementById('audioUploadArea');
            const audioFileInput = document.getElementById('audioFileInput');
            
            if (audioUploadArea && audioFileInput) {
                // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
                audioUploadArea.addEventListener('click', () => {
                    audioFileInput.click();
                });
                
                // æ–‡ä»¶é€‰æ‹©
                audioFileInput.addEventListener('change', (e) => {
                    AudioTestTemplate.handleAudioFileUpload(e);
                });
                
                // æ‹–æ‹½ä¸Šä¼ 
                audioUploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    audioUploadArea.classList.add('dragover');
                });
                
                audioUploadArea.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    audioUploadArea.classList.remove('dragover');
                });
                
                audioUploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    audioUploadArea.classList.remove('dragover');
                    
                    const files = Array.from(e.dataTransfer.files);
                    if (files.length > 0) {
                        const dt = new DataTransfer();
                        dt.items.add(files[0]);
                        audioFileInput.files = dt.files;
                        
                        const changeEvent = new Event('change', { bubbles: true });
                        audioFileInput.dispatchEvent(changeEvent);
                    }
                });
            }
        }
        
        // æµ‹è¯•éŸ³é¢‘å¤„ç†
        async function testAudioProcessing() {
            try {
                const result = await AudioTestTemplate.processAudioOriginalSound();
                alert(`âœ… ${result.message}\næ–‡ä»¶å: ${result.fileName}`);
            } catch (error) {
                alert(`âŒ ${error.message}`);
            }
        }
        
        // æ¸…é™¤éŸ³é¢‘æ–‡ä»¶
        function clearAudioFile() {
            window.selectedAudioFile = null;
            document.getElementById('audioFileInput').value = '';
            document.getElementById('audioUploadedFiles').innerHTML = '';
            document.getElementById('debugInfo').innerHTML = 'æ–‡ä»¶å·²æ¸…é™¤';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ éŸ³é¢‘å¤„ç†ä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
            initializeEventListeners();
        });
    </script>
</body>
</html>

